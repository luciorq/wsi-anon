<html>
<head>
<meta charset="utf-8"/>
<script type="module">
import AnonymizedStream from './bin/wsi-anon.js';

async function onAnonymizeWsi() {
  const files = document.getElementById("file-input").files;
  const chunkSize = 10 * 1000*1000;

  // only for MIRAX files
  // ToDo: investigate how I can find the files in the mirax directory under their relative path and not the name it was uploaded
  const dir = document.getElementById("dir-input").files;
  if (typeof dir[0] !== 'undefined'){}
    console.log(dir)
  }

  const anonStream = AnonymizedStream.create(files[0], chunkSize)
  console.log("running anonymization ...");
  try {
    await anonStream.anonymize();
    console.log("done, stream can now be uploaded");
  } catch (error) {
    alert(error);
  }
}

window.globalThis.onAnonymizeWsi = onAnonymizeWsi;
</script>
<title>wsi-anon WASM example</title>
</head>
<body>
<h2>WSI-Anon WASM</h2>
<input id="file-input" type="file" accept=".svs,.mrxs,.ndpi,.tif,.bif,.isyntax"></input>
<p>(Accepted file formats: '.svs', '.mrxs', '.ndpi', '.tif', '.bif', '.isyntax')</br></br></br></p>
<input id="dir-input" type="file" webkitdirectory></input>
<p>(ONLY if a '.mrxs' file was passed, please select the corresponding directory)</br></br></br></p>
<button onclick="onAnonymizeWsi()">Anonymize WSI</button>
<p>Open the console to see the result!</p>
</body>